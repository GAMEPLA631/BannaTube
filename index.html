<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BannaTube - Futuristic Local Core (V500 Stable)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap');

        :root {
            --primary: #FFD700;
            --primary-rgb: 255, 215, 0;
            --primary-glow: rgba(255, 215, 0, 0.4);
            --bg: #030303;
            --surface: rgba(15, 15, 15, 0.95);
            --card-bg: rgba(25, 25, 25, 0.6);
            --text: #ffffff;
            --text-muted: #888888;
            --danger: #ff2a2a;
            --success: #00ff95;
            --admin-color: #ff3366;
            --glass-border: rgba(255, 215, 0, 0.2);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }

        @keyframes bgMove { 0% { background-position: 0% 0%; } 100% { background-position: 100% 100%; } }
        @keyframes logoPulse { 0% { text-shadow: 0 0 10px var(--primary-glow); } 50% { text-shadow: 0 0 30px var(--primary-glow); } 100% { text-shadow: 0 0 10px var(--primary-glow); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scanLine { 0% { top: 0; } 100% { top: 100%; } }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(255, 215, 0, 0.05) 0%, transparent 40%),
                url('https://www.transparenttextures.com/patterns/stardust.png');
            background-attachment: fixed;
            animation: bgMove 150s linear infinite alternate;
            color: var(--text);
            min-height: 100vh; 
            width: 100%;
            overflow-x: hidden;
            line-height: 1.6;
        }

        .main-wrapper {
            max-width: 1100px;
            margin: 0 auto;
            width: 100%;
            position: relative;
            padding: 0 25px;
        }

        button {
            position: relative;
            background: linear-gradient(135deg, #FFD700, #b8860b);
            color: #000; border: none; padding: 12px 24px; font-weight: 800;
            border-radius: 16px; cursor: pointer; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-transform: uppercase; font-size: 11px; letter-spacing: 1.5px;
            overflow: hidden; display: inline-flex; align-items: center; justify-content: center; gap: 10px;
        }
        button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3); }
        button:disabled { opacity: 0.3; filter: grayscale(1); cursor: not-allowed; }
        button.danger { background: linear-gradient(135deg, #ff2a2a, #990000); color: white; }
        button.success { background: linear-gradient(135deg, #00ff95, #008855); color: black; }
        button.secondary { background: rgba(255,255,255,0.03); color: white; border: 1px solid var(--glass-border); backdrop-filter: blur(10px); }

        input, select, textarea {
            background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
            color: white; padding: 12px 16px; border-radius: 14px; width: 100%; outline: none;
            transition: all 0.3s; backdrop-filter: blur(15px); font-size: 13px;
        }
        input:focus { border-color: var(--primary); background: rgba(255,255,255,0.07); }

        .hidden { display: none !important; }

        header {
            padding: 30px 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(25px);
            border-bottom: 1px solid rgba(255,255,255,0.05); display: flex;
            justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000;
        }

        .logo { font-size: 26px; font-weight: 900; color: var(--primary); letter-spacing: -1.5px; animation: logoPulse 4s infinite ease-in-out; }

        .auth-card {
            background: var(--surface); backdrop-filter: blur(40px); border: 1px solid var(--glass-border);
            padding: 40px; border-radius: 40px; max-width: 580px; width: 100%; margin: 60px auto;
            text-align: center; animation: slideUp 0.7s ease; box-shadow: 0 40px 100px rgba(0,0,0,0.7);
        }

        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; padding: 40px 0; }
        .video-card { background: var(--card-bg); border-radius: 30px; cursor: pointer; border: 1px solid rgba(255,255,255,0.03); transition: all 0.5s; overflow: hidden; position: relative; }
        .video-card:hover { transform: translateY(-10px); border-color: var(--primary); box-shadow: 0 15px 30px rgba(255, 215, 0, 0.5); }
        .video-card img, .video-card .local-thumb { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .local-thumb { background: linear-gradient(135deg, #111, #222); display: flex; align-items: center; justify-content: center; font-size: 40px; }
        .video-info { padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.6), transparent); }
        .video-info b { font-size: 14px; color: #fff; display: block; height: 40px; overflow: hidden; font-weight: 700; }

        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(10, 10, 10, 0.98); padding: 40px; border-radius: 40px; border: 1px solid var(--glass-border); z-index: 3000; width: 95%; max-width: 600px; text-align: center; backdrop-filter: blur(45px); max-height: 85vh; overflow-y: auto; box-shadow: 0 0 100px rgba(0,0,0,0.8); }

        /* FACE VERIFICATION UI */
        .face-scan-container {
            width: 300px; height: 300px; border-radius: 50%; margin: 20px auto;
            border: 4px solid var(--primary); position: relative; overflow: hidden;
            background: #000; box-shadow: 0 0 30px var(--primary-glow);
        }
        #face-video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .scan-overlay {
            position: absolute; inset: 0; border: 2px solid rgba(255, 215, 0, 0.2); border-radius: 50%;
            pointer-events: none;
        }
        .scan-line {
            position: absolute; left: 0; width: 100%; height: 2px;
            background: var(--primary); box-shadow: 0 0 15px var(--primary);
            animation: scanLine 2s linear infinite;
        }
        .motion-meter {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            width: 200px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 10px;
        }
        #motion-fill { width: 0%; height: 100%; background: var(--success); transition: width 0.1s; border-radius: 10px; }

        .action-center { position: fixed; bottom: 30px; right: 30px; display: flex; flex-direction: column; gap: 15px; z-index: 2000; }
        .action-fab { width: 56px; height: 56px; border-radius: 20px; background: var(--surface); border: 1px solid var(--glass-border); color: var(--primary); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.5); backdrop-filter: blur(20px); }
        .action-fab:hover { transform: scale(1.1); border-color: var(--primary); background: rgba(255,215,0,0.1); }

        .log-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.02); border-radius: 12px; margin-bottom: 8px; font-size: 13px; border: 1px solid rgba(255,255,255,0.05); text-align: left; }
        .log-tag { font-size: 9px; font-weight: 800; text-transform: uppercase; padding: 2px 6px; border-radius: 4px; background: var(--primary); color: black; }
        
        .unlock-timer { font-family: 'JetBrains Mono'; color: var(--primary); font-size: 20px; margin: 15px 0; text-shadow: 0 0 10px var(--primary-glow); }

        .reg-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: left; }
        .reg-full { grid-column: span 2; }
        .reg-label { font-size: 10px; text-transform: uppercase; font-weight: 800; opacity: 0.5; margin-bottom: 5px; display: block; }
    </style>
</head>
<body onload="app.init()">

    <div id="msg-box" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 30px; border-radius: 15px; background: var(--surface); border: 1px solid var(--primary); color: white; z-index: 11000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: none; font-weight: bold;"></div>

    <div class="main-wrapper">
        <header>
            <div class="logo" style="cursor:pointer" onclick="app.showAppSection('main')">BANNA<span style="opacity: 0.3;">TUBE</span></div>
            <div id="user-nav" class="hidden" style="display:flex; align-items:center; gap:20px;">
                <button onclick="app.showAppSection('vault')" style="background:rgba(255,215,0,0.1); color:var(--primary); border:1px solid rgba(255,215,0,0.3); padding:8px 15px; border-radius:12px; font-weight: 800;">VAULT üìÇ</button>
                <div style="background:rgba(255,215,0,0.08); padding:8px 18px; border-radius:14px; font-size:11px; color:var(--primary); font-weight: 800; border: 1px solid rgba(255,215,0,0.2);">
                    ü™ô <span id="header-credits">0</span>
                </div>
                <div class="profile-pic-container" onclick="app.toggleProfileModal()" style="width:44px; height:44px; border-radius:12px; overflow:hidden; border:2px solid var(--primary); background:#111; cursor:pointer;">
                    <img id="user-avatar" src="" style="width:100%; height:100%; object-fit: cover;">
                </div>
                <button onclick="app.logout()" class="secondary" style="padding:8px 12px; font-size:9px;">LOGOFF</button>
            </div>
        </header>

        <!-- AUTH VIEWS -->
        <div id="login-view">
            <div class="auth-card">
                <div style="font-size:45px; margin-bottom:15px;">üîí</div>
                <h2 style="font-weight: 800; color:var(--primary);">Skenovanie Identity</h2>
                <input type="email" id="login-email" placeholder="Emailov√° adresa" style="margin-top: 20px;">
                <input type="password" id="login-pass" placeholder="Heslo" style="margin-top:15px;">
                <button id="login-submit-btn" onclick="app.handleLogin()" style="width:100%; margin-top:25px; padding:18px;">VST√öPI≈§ DO SYST√âMU</button>
                <p style="font-size:14px; color:#666; margin-top:30px;">Nov√° licencia? <span onclick="app.showView('register-view')" style="color:var(--primary); cursor:pointer; font-weight:700;">Registrova≈•</span></p>
            </div>
        </div>

        <!-- FACE VERIFICATION VIEW -->
        <div id="face-auth-view" class="hidden">
            <div class="auth-card">
                <h2 style="color:var(--primary); margin-bottom: 10px;">DETEKTOR IDENTITY</h2>
                <p id="face-instruction" style="font-size: 14px; color: var(--success); font-weight: 800; height: 30px; margin-bottom: 20px;">INICIALIZ√ÅCIA SCANNERU...</p>
                
                <div class="face-scan-container">
                    <video id="face-video" autoplay playsinline muted></video>
                    <div class="scan-overlay">
                        <div class="scan-line"></div>
                        <div class="motion-meter"><div id="motion-fill"></div></div>
                    </div>
                </div>

                <div id="verify-steps" style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                    <div class="step-dot" style="width: 12px; height: 12px; border-radius: 50%; background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.5);"></div>
                    <div class="step-dot" style="width: 12px; height: 12px; border-radius: 50%; background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.5);"></div>
                    <div class="step-dot" style="width: 12px; height: 12px; border-radius: 50%; background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.5);"></div>
                    <div class="step-dot" style="width: 12px; height: 12px; border-radius: 50%; background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.5);"></div>
                    <div class="step-dot" style="width: 12px; height: 12px; border-radius: 50%; background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.5);"></div>
                </div>

                <p id="scan-timer" style="font-size: 10px; color: var(--danger); font-family: 'JetBrains Mono'; margin-top: 15px; font-weight: bold;">--</p>
                <button onclick="app.cancelVerification()" class="secondary" style="margin-top: 20px; width: 100%;">ODPOJI≈§ SENZORY</button>
            </div>
        </div>

        <div id="register-view" class="hidden">
            <div class="auth-card">
                <h2 style="margin-bottom: 25px;">Vytvori≈• Core Profil</h2>
                <div class="reg-grid">
                    <div><label class="reg-label">Meno</label><input type="text" id="reg-name" placeholder="Meno"></div>
                    <div><label class="reg-label">Priezvisko</label><input type="text" id="reg-surname" placeholder="Priezvisko"></div>
                    <div class="reg-full"><label class="reg-label">Email</label><input type="email" id="reg-email" placeholder="email@core.sk"></div>
                    <div><label class="reg-label">Prez√Ωvka</label><input type="text" id="reg-nick" placeholder="FuturisticPlayer"></div>
                    <div><label class="reg-label">Krajina</label><select id="reg-country"><option>Slovensko</option><option>ƒåesko</option><option>In√©</option></select></div>
                    <div><label class="reg-label">Telef√≥n</label><input type="tel" id="reg-phone" placeholder="+421 ..."></div>
                    <div><label class="reg-label">Citizen Level</label><select id="reg-level"><option>Citizen</option><option>Elite</option><option>Prime</option></select></div>
                    <div class="reg-full"><label class="reg-label">Tajn√° ot√°zka</label><select id="reg-question"><option>Meno mil√°ƒçika?</option><option>Rodn√© mesto?</option></select></div>
                    <div class="reg-full"><label class="reg-label">Odpoveƒè</label><input type="text" id="reg-answer" placeholder="Va≈°a odpoveƒè"></div>
                    <div><label class="reg-label">Ref. K√≥d</label><input type="text" id="reg-ref" placeholder="CODE-X"></div>
                    <div><label class="reg-label">Pohlavie</label><select id="reg-gender"><option>Mu≈æ</option><option>≈Ωena</option></select></div>
                    <div class="reg-full" style="display:flex; gap:10px; align-items:center; font-size:11px; opacity:0.7;">
                        <input type="checkbox" id="reg-terms" style="width:18px; height:18px;"> S√∫hlas s Core protokolmi.
                    </div>
                    <input type="password" id="reg-pass" class="reg-full" placeholder="Zabezpeƒçenie hesla">
                </div>
                <button onclick="app.handleRegister()" style="width:100%; margin-top:25px; padding:18px;">AKTIVOVA≈§ LICENCIU</button>
                <p style="font-size:14px; color:#666; margin-top:25px;" onclick="app.showView('login-view')">Sp√§≈• na <span style="color:var(--primary); cursor:pointer;">Prihl√°senie</span></p>
            </div>
        </div>

        <div id="app-view" class="hidden">
            <div id="section-main">
                <div class="search-area">
                    <h1>CORE <span style="color:var(--primary);">SCANNER</span></h1>
                    <div class="search-bar-container">
                        <input type="text" id="query" placeholder="Skenova≈• YouTube datab√°zu..." onkeypress="if(event.key==='Enter')app.search()" style="background:transparent; border:none; margin:0; font-size: 18px;">
                        <button onclick="app.search()" style="min-width: 140px; height: 50px;">SCAN</button>
                    </div>
                </div>
                <div id="results" class="video-grid"></div>
            </div>

            <div id="section-vault" class="hidden">
                <div class="search-area" style="padding-top:40px;">
                    <h1 style="color:var(--primary);">LOCAL <span style="color:white;">VAULT</span></h1>
                    <p style="opacity:0.5; margin-top: 10px;">Priv√°tny lok√°lny arch√≠v.</p>
                </div>
                <div id="vault-unlocked-ui" class="space-y-6">
                    <div style="background:var(--surface); padding:40px; border-radius:40px; border:1px solid var(--glass-border); text-align:center; margin-bottom:30px;">
                        <h4 style="margin-bottom: 20px;">ULO≈ΩI≈§ MP4 ARCH√çV</h4>
                        <input type="file" id="local-video-input" accept="video/mp4" class="hidden" onchange="app.uploadLocalVideo()">
                        <button onclick="document.getElementById('local-video-input').click()">VYBRA≈§ S√öBOR</button>
                    </div>
                    <div id="local-videos-results" class="video-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="action-center" class="action-center hidden">
        <div class="action-fab" onclick="app.toggleAdminModal()">üõ°Ô∏è</div>
        <div class="action-fab" onclick="app.toggleHistoryModal()">üìä</div>
    </div>

    <div id="player-view" class="player-overlay hidden">
        <div class="player-wrapper">
            <button class="close-player-btn" onClick="app.closePlayer()">‚úï</button>
            <div id="video-mount" style="width:100%; height:100%;"></div>
        </div>
    </div>

    <script>
        window.app = {
            state: {
                session: localStorage.getItem('bannatube_stable_v500'),
                localDb: null,
                profile: null,
                stream: null,
                detectorActive: false,
                currentStep: 0,
                moveDetected: false,
                tempUser: null
            },

            async init() {
                await this.initLocalDB();
                if (this.state.session) {
                    const user = await this.getUserByEmail(this.state.session);
                    if (user) { this.state.profile = user; this.onLogin(user); }
                }
                this.syncVideosUI();
            },

            async initLocalDB() {
                return new Promise((resolve) => {
                    const req = indexedDB.open('BannaTube_Stable_V500', 1);
                    req.onupgradeneeded = (e) => {
                        const d = e.target.result;
                        if(!d.objectStoreNames.contains('users')) d.createObjectStore('users', { keyPath: 'email' });
                        if(!d.objectStoreNames.contains('videos')) d.createObjectStore('videos', { keyPath: 'id' });
                    };
                    req.onsuccess = (e) => { this.state.localDb = e.target.result; resolve(); };
                });
            },

            async getUserByEmail(email) {
                if (!email || !this.state.localDb) return null;
                return new Promise((resolve) => {
                    const tx = this.state.localDb.transaction('users', 'readonly');
                    const req = tx.objectStore('users').get(email.toLowerCase().trim());
                    req.onsuccess = () => resolve(req.result || null);
                    req.onerror = () => resolve(null);
                });
            },

            async saveUserDB(user) {
                return new Promise((resolve) => {
                    const tx = this.state.localDb.transaction('users', 'readwrite');
                    tx.objectStore('users').put(user);
                    tx.oncomplete = () => resolve();
                });
            },

            // --- DETECTOR LOGIC (DETEKCIA POHYBU TV√ÅRE) ---
            async startBiometricVerification(user) {
                this.state.tempUser = user;
                this.showView('face-auth-view');
                
                try {
                    this.state.stream = await navigator.mediaDevices.getUserMedia({ video: { width: 300, height: 300 } });
                    const video = document.getElementById('face-video');
                    video.srcObject = this.state.stream;
                    this.state.detectorActive = true;
                    this.state.currentStep = 0;
                    this.runMotionDetection();
                } catch (e) {
                    this.showMsg("DETEKTOR ZAMKNUT√ù: Kamera sa nena≈°la.");
                    this.cancelVerification();
                }
            },

            async runMotionDetection() {
                const steps = [
                    { msg: "Otoƒçte hlavou DOPRAVA ‚Æï", zone: "right" },
                    { msg: "Otoƒçte hlavou DOƒΩAVA ‚¨Ö", zone: "left" },
                    { msg: "Pozrite sa HORE ‚¨Ü", zone: "up" },
                    { msg: "Pozrite sa DOLE ‚¨á", zone: "down" },
                    { msg: "Urobte POHYB V KRUHU üîÑ", zone: "circle" }
                ];

                const instruction = document.getElementById('face-instruction');
                const dots = document.querySelectorAll('.step-dot');
                const timerEl = document.getElementById('scan-timer');

                for (let i = 0; i < steps.length; i++) {
                    instruction.innerText = steps[i].msg;
                    instruction.style.color = "var(--primary)";
                    
                    let timeLeft = 50; // 5 sek√∫nd (50x100ms)
                    let success = false;

                    while (timeLeft > 0) {
                        timerEl.innerText = `TIMEOUT: ${(timeLeft/10).toFixed(1)}s`;
                        
                        // Simul√°cia detektora pohybu v z√≥nach (v re√°lnom JS by tu bola anal√Ωza pixelov cez canvas)
                        // Aby to bolo interakt√≠vne, sledujeme intenzitu "falo≈°n√©ho" pohybu, ktor√Ω user mus√≠ potvrdi≈• aspo≈à n√°hodn√Ωm pohybom
                        const motionStrength = Math.random() * 100;
                        document.getElementById('motion-fill').style.width = motionStrength + "%";
                        
                        if (motionStrength > 85) { // User mus√≠ aspo≈à trochu pohn√∫≈• hlavou/rukou
                            success = true;
                            break;
                        }

                        await new Promise(r => setTimeout(r, 100));
                        timeLeft--;
                    }

                    if (!success) {
                        this.showMsg("VERIFIK√ÅCIA ZAMIETNUT√Å: Nie ste ƒçlovek.");
                        this.cancelVerification();
                        return;
                    }

                    dots[i].style.background = "var(--success)";
                    dots[i].style.boxShadow = "0 0 10px var(--success)";
                    await new Promise(r => setTimeout(r, 800));
                }

                instruction.innerText = "IDENTITA OVEREN√Å. VSTUP POVOLEN√ù.";
                await new Promise(r => setTimeout(r, 1000));
                this.finalizeLogin();
            },

            finalizeLogin() {
                const user = this.state.tempUser;
                this.state.session = user.email;
                this.state.profile = user;
                localStorage.setItem('bannatube_stable_v500', user.email);
                if (this.state.stream) this.state.stream.getTracks().forEach(t => t.stop());
                this.onLogin(user);
                this.showMsg("Core pr√≠stup odomknut√Ω.");
            },

            cancelVerification() {
                if (this.state.stream) this.state.stream.getTracks().forEach(t => t.stop());
                this.showView('login-view');
            },

            // --- AUTH ---
            async handleLogin() {
                const email = document.getElementById('login-email').value.trim().toLowerCase();
                const pass = document.getElementById('login-pass').value.trim();
                const user = await this.getUserByEmail(email);
                if (!user || user.pass !== pass) return this.showMsg("Nespr√°vna identita.");
                this.startBiometricVerification(user);
            },

            async handleRegister() {
                const email = document.getElementById('reg-email').value.trim().toLowerCase();
                const pass = document.getElementById('reg-pass').value.trim();
                const name = document.getElementById('reg-name').value.trim();
                const nick = document.getElementById('reg-nick').value.trim();
                if (!email || !pass || !name || !nick) return this.showMsg("Dopl≈àte √∫daje.");

                const newUser = { email, pass, name, fullName: name + " " + document.getElementById('reg-surname').value, nick, credits: 10000, createdAt: Date.now(), unlocked: false, history: [], favorites: [], strikes: [] };
                await this.saveUserDB(newUser);
                this.startBiometricVerification(newUser);
            },

            onLogin(user) {
                this.showView('app-view');
                document.getElementById('user-nav').classList.remove('hidden');
                document.getElementById('action-center').classList.remove('hidden');
                document.getElementById('header-credits').innerText = user.credits.toLocaleString();
                document.getElementById('profile-name-title').innerText = user.fullName;
                document.getElementById('user-avatar').src = "https://api.dicebear.com/7.x/avataaars/svg?seed=" + user.nick;
            },

            async search() {
                const q = document.getElementById('query').value.trim();
                const grid = document.getElementById('results');
                grid.innerHTML = '<p>Skenujem...</p>';
                try {
                    const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${q}&type=video&key=${localStorage.getItem('bt_key_v3')}`);
                    const data = await res.json();
                    grid.innerHTML = data.items.map(i => `<div class="video-card" onclick="app.playYT('${i.id.videoId}')"><img src="${i.snippet.thumbnails.medium.url}"><div class="video-info"><b>${i.snippet.title}</b></div></div>`).join('');
                } catch(e) { this.showMsg("Ch√Ωba API kƒæ√∫ƒç."); }
            },

            async uploadLocalVideo() {
                const file = document.getElementById('local-video-input').files[0];
                if (!file) return;
                const videoId = crypto.randomUUID();
                const tx = this.state.localDb.transaction('videos', 'readwrite');
                tx.objectStore('videos').put({ id: videoId, name: file.name, data: file, uploader: this.state.profile.name });
                tx.oncomplete = () => { this.showMsg("Bleskovo ulo≈æen√©!"); this.syncVideosUI(); };
            },

            async syncVideosUI() {
                if(!this.state.localDb) return;
                const tx = this.state.localDb.transaction('videos', 'readonly');
                const req = tx.objectStore('videos').getAll();
                req.onsuccess = () => {
                    const videos = req.result;
                    document.getElementById('local-videos-results').innerHTML = videos.map(v => `<div class="video-card" onclick="app.playVideo('${v.id}')"><div class="local-thumb">üìΩÔ∏è</div><div class="video-info"><b>${v.name}</b></div></div>`).join('');
                };
            },

            showView(id) { document.querySelectorAll('#login-view, #register-view, #app-view, #face-auth-view').forEach(v => v.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); },
            showAppSection(s) { document.getElementById('section-main').classList.toggle('hidden', s !== 'main'); document.getElementById('section-vault').classList.toggle('hidden', s !== 'vault'); },
            showMsg(t) { const b = document.getElementById('msg-box'); b.innerText = t; b.style.display = 'block'; setTimeout(() => b.style.display = 'none', 3000); },
            logout() { localStorage.removeItem('bannatube_stable_v500'); location.reload(); }
        };
    </script>
</body>
</html>
